!function(a){function c(a,b){window.console&&window.console.trace&&(console.trace(a),b&&console.trace(b))}function d(a){var b={};return b.id=a.attr("data-id"),b.key=a.attr("data-key"),b.index=a.attr("data-index"),b}function e(a,b,c){var g,d=b||{},e=d.id||"",f=d.key||"";c&&c.multiWord?(g=a.val().split(c.separator||" "),g[g.length-1]=f,a.val(g.join(c.separator||" ")).focus()):a.attr("data-id",e).focus().val(f),a.trigger("onSetSelectValue",[d,(c.data.value||c.result.value)[d.index]])}function f(c,d,e){if(d.is(":visible")){e.autoDropup&&setTimeout(function(){a(window).height()+a(window).scrollTop()-c.offset().top<d.height()&&c.offset().top>d.height()+a(window).scrollTop()?d.parents(".input-group").addClass("dropup"):d.parents(".input-group.dropup").removeClass("dropup")},10);var f;return"left"===e.listAlign?f={left:c.siblings("div").width()-c.parent().width(),right:"auto"}:"right"===e.listAlign&&(f={left:"auto",right:"0"}),b&&!e.showBtn&&(d.parents(".input-group").hasClass("dropup")?(f.top="auto",f.bottom=c.parent().height()):(f.top=c.parent().height(),f.bottom="auto")),e.autoMinWidth===!1&&(f["min-width"]=c.parent().width()),d.css(f),c}}function g(a,b){var c,d,e;return b.indexId===-1&&!b.idField||b.multiWord?a:(c=a.css("background-color").replace(/ /g,"").split(",",3).join(","),d=b.inputBgColor||"rgba(255,255,255,0.1)",e=b.inputWarnColor||"rgba(255,255,0,0.1)",!a.val()||a.attr("data-id")?a.css("background",d):(-1===e.indexOf(c)&&(a.trigger("onUnsetSelectValue"),a.css("background",e)),a))}function h(a,b,c){var e,f,d=a.parent().find("tbody tr."+c.listHoverCSS);d.length>0&&(e=(d.index()+3)*d.height(),f=Number(b.css("max-height").replace("px","")),e>f||b.scrollTop()>f?b.scrollTop(e-f):b.scrollTop(0))}function i(a,b){a.find("tr."+b.listHoverCSS).removeClass(b.listHoverCSS)}function j(b,c){var d=a(b),e=d.parent(".input-group").find("ul.dropdown-menu"),f=d.data("bsSuggest");return 0!==e.length&&(!f&&(d.data("bsSuggest",{target:b,options:c}),!0))}function k(a){var b=!0;for(var d in a)if("value"===d){b=!1;break}return b?(c("返回数据格式错误!"),!1):0!==a.value.length&&a}function l(b,c){return!("__index"===b||a.isArray(c.effectiveFields)&&c.effectiveFields.length>0&&a.inArray(b,c.effectiveFields)===-1)}function m(b,c){return a.inArray(b,c.searchFields)!==-1}function n(a,c,d){var g,h,i,k,n,o,e=a.parent().find("ul.dropdown-menu"),j=0,m=['<table class="table table-condensed table-sm">'];if(c=d.processData(c),c===!1||0===(g=c.value.length))return e.empty().hide(),a;if(d._lastData&&JSON.stringify(d._lastData.value)===JSON.stringify(c.value)&&e.find("tr").length===c.value.length)return e.show(),f(a,e,d),a;if(d._lastData=c,d.showHeader){m.push("<thead><tr>");for(i in c.value[0])l(i,d)!==!1&&(0===j?m.push("<th>"+(d.effectiveFieldsAlias[i]||i)+"("+g+")</th>"):m.push("<th>"+(d.effectiveFieldsAlias[i]||i)+"</th>"),j++);m.push("</tr></thead>")}for(m.push("<tbody>"),h=0;h<g;h++){j=0,k=[],n=c.value[h][d.idField]||"",o=c.value[h][d.keyField]||"";for(i in c.value[h])o||d.indexKey!==j||(o=c.value[h][i]),n||d.indexId!==j||(n=c.value[h][i]),j++,l(i,d)!==!1&&k.push('<td data-name="',i,'">',c.value[h][i],"</td>");m.push('<tr data-index="',c.value[h].__index||h,'" data-id="',n,'" data-key="',o,'">',k.join(""),"</tr>")}return m.push("</tbody></table>"),e.html(m.join("")).show(),setTimeout(function(){!b&&e.height()<e.find("table:eq(0)").height()&&Number(e.css("min-width").replace("px",""))<e.width()?e.css("padding-right","20px").find("table:eq(0)").css("margin-bottom","20px"):e.css("padding-right",0).find("table:eq(0)").css("margin-bottom",0)},301),f(a,e,d),a}function o(b,d){d=d||"";var e={type:"GET",url:function(){var a="?";return/=$/.test(b.url)?a="":/\?/.test(b.url)&&(a="&"),b.url+a+d}(),dataType:"json",timeout:5e3};return b.jsonp&&(e.jsonp=b.jsonp,e.dataType="jsonp"),a.isFunction(b.fnAdjustAjaxParam)&&(e=a.extend(e,b.fnAdjustAjaxParam(d,b))),a.ajax(e).done(function(a){b.data=a}).fail(c)}function p(b,c,d,e){var f,g,i,j,n,h={value:[]};if(b=b||"",a.isFunction(e.fnPreprocessKeyword)&&(b=e.fnPreprocessKeyword(b,e)),e.url)o(e,b).done(function(a){d(c,a,e),c.trigger("onDataRequestSuccess",a),"firstByUrl"===e.getDataMethod?e.url=null:e.result=e.processData(a)});else{if(f=e.data,g=k(f))if(b){for(n=f.value.length,i=0;i<n;i++)for(j in f.value[i])if(a.trim(f.value[i][j])&&(m(j,e)||l(j,e))&&(f.value[i][j].toString().indexOf(b)!==-1||b.indexOf(f.value[i][j])!==-1)){h.value.push(f.value[i]),h.value[h.value.length-1].__index=i;break}}else h=f;d(c,h,e)}}function q(a){return k(a)}var b=!!window.ActiveXObject||"ActiveXObject"in window,r={init:function(b){var c=this;return!b.showHeader&&b.effectiveFields&&b.effectiveFields.length>1&&(b.showHeader=!0),"firstByUrl"===b.getDataMethod&&b.url&&!b.delayUntilKeyup&&o(b,"").done(function(d){b.url=null,a(c).trigger("onDataRequestSuccess",d)}),a("head:eq(0)").append("<style>."+b.listHoverCSS+"{"+b.listHoverStyle+"}</style>"),c.each(function(){var k,c=a(this),l=c.parents(".input-group:eq(0)").find("ul.dropdown-menu");return j(this,b)===!1?void console.warn("不是一个标准的 bootstrap 下拉式菜单或已初始化:",this):(b.showBtn||c.css("border-radius","4px").parents(".input-group:eq(0)").css("width","100%").find(".input-group-btn>.btn").hide(),c.removeClass("disabled").attr("disabled",!1).attr("autocomplete","off"),l.css(b.listStyle),b.inputBgColor||(b.inputBgColor=c.css("background-color")),c.on("keydown",function(f){var g,j="";if("none"!==l.css("display")){if(g=l.find("."+b.listHoverCSS),j="",f.keyCode===b.keyDown){if(0===g.length?j=d(l.find("table tbody tr:first").mouseover()):0===g.next().length?(i(l,b),b.autoSelect&&a(this).val(a(this).attr("alt")).attr("data-id","")):(i(l,b),0!==g.next().length&&(j=d(g.next().mouseover()))),h(c,l,b),!b.autoSelect)return}else if(f.keyCode===b.keyUp){if(0===g.length?j=d(l.find("table tbody tr:last").mouseover()):0===g.prev().length?(i(l,b),b.autoSelect&&a(this).val(a(this).attr("alt")).attr("data-id","")):(i(l,b),0!==g.prev().length&&(j=d(g.prev().mouseover()))),h(c,l,b),!b.autoSelect)return}else f.keyCode===b.keyEnter?(j=d(g),l.hide().empty()):a(this).attr("data-id","");j&&""!==j.key&&e(a(this),j,b)}}).on("keyup",function(d){var e,f;return d.keyCode===b.keyDown||d.keyCode===b.keyUp||d.keyCode===b.keyEnter?(a(this).val(a(this).val()),void g(c,b)):(a(this).attr("data-id",""),g(c,b),e=a(this).val(),void(""!==a.trim(e)&&e===a(this).attr("alt")||(a(this).attr("alt",a(this).val()),b.multiWord&&(f=e.split(b.separator||" "),e=f[f.length-1]),(0!==e.length||b.allowNoKeyword)&&b.getData(a.trim(e),c,n,b))))}).on("focus",function(){f(c,l,b)}).on("blur",function(){k||l.css("display","")}).on("click",function(){var e,d=a(this).val();return""!==a.trim(d)&&d===a(this).attr("alt")&&l.find("table tr").length?l.show():void("none"===l.css("display")&&(b.multiWord&&(e=d.split(b.separator||" "),d=e[e.length-1]),(0!==d.length||b.allowNoKeyword)&&b.getData(a.trim(d),c,n,b)))}),c.parent().find("button:eq(0)").attr("data-toggle","").on("click",function(){var a;return"none"===l.css("display")?(a="block",b.url?(c.click().focus(),l.find("tr").length||(a="none")):n(c,b.data,b)):a="none",l.css("display",a),!1}),void l.on("mouseenter",function(){k=1,c.blur()}).on("mouseleave",function(){k=0,c.focus()}).on("mouseenter","tbody tr",function(){return i(l,b),a(this).addClass(b.listHoverCSS),!1}).on("mousedown","tbody tr",function(){e(c,d(a(this)),b),g(c,b),l.hide()}))})},show:function(){var a=this.data("bsSuggest");return a&&a.options&&this.parent().find("ul.dropdown-menu").show(),this},hide:function(){var a=this.data("bsSuggest");return a&&a.options&&this.parent().find("ul.dropdown-menu").css("display",""),this},disable:function(){return!!a(this).data("bsSuggest")&&void a(this).attr("disabled",!0).parent().find(".input-group-btn>.btn").addClass("disabled")},enable:function(){return!!a(this).data("bsSuggest")&&void a(this).attr("disabled",!1).parent().find(".input-group-btn>.btn").removeClass("disabled")},destroy:function(){a(this).off().removeData("bsSuggest").parent().find(".input-group-btn>.btn").off()},version:function(){return"0.0.1"}},s={url:null,jsonp:null,data:{},getDataMethod:"firstByUrl",delayUntilKeyup:!1,indexId:0,indexKey:0,idField:"",keyField:"",effectiveFields:[],effectiveFieldsAlias:{},searchFields:[],showHeader:!1,showBtn:!0,allowNoKeyword:!0,multiWord:!1,separator:",",processData:q,getData:p,fnAdjustAjaxParam:null,fnPreprocessKeyword:null,autoMinWidth:!1,autoDropup:!1,autoSelect:!0,listAlign:"left",inputBgColor:"",inputWarnColor:"rgba(255,0,0,.1)",listStyle:{"padding-top":0,"max-height":"375px","max-width":"800px",overflow:"auto",width:"auto",transition:"0.3s","-webkit-transition":"0.3s","-moz-transition":"0.3s","-o-transition":"0.3s"},listHoverStyle:"background: #07d; color:#fff",listHoverCSS:"jhover",keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyEnter:13};a.fn.bsSuggest=function(b){return"string"==typeof b&&r[b]?r[b].apply(this,[].prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void 0:(b=a.extend(!0,{},s,b),r.init.apply(this,arguments))}}(window.jQuery);