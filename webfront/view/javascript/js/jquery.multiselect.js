!function(a){function d(c,d){this.element=c,this.options=a.extend({},b,d),this.load()}var b={placeholder:"Select options",columns:1,search:!1,searchOptions:{default:"Search",showOptGroups:!1,onSearch:function(a){}},selectAll:!1,selectGroup:!1,minHeight:200,maxHeight:null,showCheckbox:!0,jqActualOpts:{},onLoad:function(b){a(b).hide()},onOptionClick:function(a,b){},maxWidth:null,minSelect:!1,maxSelect:!1},c=1;d.prototype={load:function(){var b=this;if("SELECT"!=b.element.nodeName||a(b.element).hasClass("jqmsLoaded"))return!0;a(b.element).addClass("jqmsLoaded"),a(b.element).after('<div class="ms-options-wrap"><button><p>None Selected</p></button><div class="ms-options"><ul></ul></div></div>');var c=a(b.element).next(".ms-options-wrap").find("> button:first-child"),d=a(b.element).next(".ms-options-wrap").find("> .ms-options"),e=d.find("> ul"),f=!!a(b.element).find("optgroup").length,g=null;"number"==typeof b.options.width?(d.parent().css("position","relative"),g=b.options.width):"string"==typeof b.options.width?(a(b.options.width).css("position","relative"),g="100%"):d.parent().css("position","relative");var h=a(window).height()-d.offset().top-20;if(b.options.maxHeight&&(h=a(window).height()-d.offset().top-20,h=h<b.options.minHeight?b.options.minHeight:maxheight),h=h<b.options.minHeight?b.options.minHeight:h,d.css({maxWidth:g,minHeight:b.options.minHeight,maxHeight:h,overflow:"auto"}).hide(),d.bind("touchmove mousewheel DOMMouseScroll",function(b){if(a(this).outerHeight()<a(this)[0].scrollHeight){var c=b.originalEvent,d=c.wheelDelta||-c.detail;a(this).outerHeight()+a(this)[0].scrollTop>a(this)[0].scrollHeight&&(b.preventDefault(),this.scrollTop+=d<0?1:-1)}}),a(document).off("click.ms-hideopts").on("click.ms-hideopts",function(b){a(b.target).closest(".ms-options-wrap").length||a(".ms-options-wrap > .ms-options:visible").hide()}),c.bind("mousedown",function(c){if(1!=c.which)return!0;if(a(".ms-options-wrap > .ms-options:visible").each(function(){a(this).parent().prev()[0]!=d.parent().prev()[0]&&a(this).hide()}),d.toggle(),d.is(":visible")){d.css("maxHeight","");var e=a(window).height()-d.offset().top-20;b.options.maxHeight&&(e=a(window).height()-d.offset().top-20,e=e<b.options.minHeight?b.options.minHeight:maxheight),e=e<b.options.minHeight?b.options.minHeight:e,d.css("maxHeight",e)}}).click(function(a){a.preventDefault()}),b.options.placeholder&&c.text(b.options.placeholder),b.options.search){e.before('<div class="ms-search"><input type="text" value="" placeholder="'+b.options.searchOptions.default+'" /></div>');var i=d.find(".ms-search input");i.on("keyup",function(){return a(this).data("lastsearch")==a(this).val()||(a(this).data("lastsearch",a(this).val()),"function"==typeof b.options.searchOptions.onSearch&&b.options.searchOptions.onSearch(b.element),void e.find("li:not(.optgroup)").each(function(){var c=a(this).text();c.toLowerCase().indexOf(i.val().toLowerCase())>-1?a(this).show():a(this).hasClass("selected")||a(this).hide(),!b.options.searchOptions.showOptGroups&&a(this).closest("li.optgroup")&&(a(this).closest("li.optgroup").show(),a(this).closest("li.optgroup").find("li:visible").length?a(this).closest("li.optgroup").show():a(this).closest("li.optgroup").hide())}))})}b.options.selectAll&&e.before('<a href="#" class="ms-selectall global">Select all</a>'),d.on("click",".ms-selectall",function(b){if(b.preventDefault(),a(this).hasClass("global"))e.find("li:not(.optgroup)").filter(":not(.selected)").length?e.find("li:not(.optgroup)").filter(":not(.selected)").find('input[type="checkbox"]').trigger("click"):e.find('li:not(.optgroup).selected input[type="checkbox"]').trigger("click");else if(a(this).closest("li").hasClass("optgroup")){var c=a(this).closest("li.optgroup");c.find("li:not(.selected)").length?c.find('li:not(.selected) input[type="checkbox"]').trigger("click"):c.find('li.selected input[type="checkbox"]').trigger("click")}});var j=[];a(b.element).children().each(function(){if("OPTGROUP"==this.nodeName){var b=[];a(this).children("option").each(function(){b[a(this).val()]={name:a(this).text(),value:a(this).val(),checked:a(this).prop("selected")}}),j.push({label:a(this).attr("label"),options:b})}else{if("OPTION"!=this.nodeName)return!0;j.push({name:a(this).text(),value:a(this).val(),checked:a(this).prop("selected")})}}),b.loadOptions(j),f?(e.find("> li:not(.optgroup)").css({float:"left",width:100/b.options.columns+"%"}),e.find("li.optgroup").css({clear:"both"}).find("> ul").css({"column-count":b.options.columns,"column-gap":0,"-webkit-column-count":b.options.columns,"-webkit-column-gap":0,"-moz-column-count":b.options.columns,"-moz-column-gap":0}),this._ieVersion()&&this._ieVersion()<10&&e.find("li.optgroup > ul > li").css({float:"left",width:100/b.options.columns+"%"})):(e.css({"column-count":b.options.columns,"column-gap":0,"-webkit-column-count":b.options.columns,"-webkit-column-gap":0,"-moz-column-count":b.options.columns,"-moz-column-gap":0}),this._ieVersion()&&this._ieVersion()<10&&e.find("> li").css({float:"left",width:100/b.options.columns+"%"})),d.on("click",'input[type="checkbox"]',function(){a(this).closest("li").toggleClass("selected");var c=d.parent().prev();c.find('option[value="'+a(this).val()+'"]').prop("selected",a(this).is(":checked")).closest("select").trigger("change"),"function"==typeof b.options.onOptionClick&&b.options.onOptionClick(),b._updatePlaceholderText()}),"function"==typeof b.options.onLoad?b.options.onLoad(b.element):a(b.element).hide()},loadOptions:function(b,c){c="boolean"!=typeof c||c;var d=this,e=a(d.element).next(".ms-options-wrap").find("> .ms-options > ul");c&&e.find("> li").remove();for(var f in b){var g=b[f],h=a("<li></li>");if(g.hasOwnProperty("options")){h.addClass("optgroup"),h.append('<span class="label">'+g.label+"</span>"),h.find("> .label").css({clear:"both"}),d.options.selectGroup&&h.append('<a href="#" class="ms-selectall">Select all</a>'),h.append("<ul></ul>");for(var i in g.options){var j=g.options[i],k=a("<li></li>").addClass("ms-reflow");d._addOption(k,j),h.find("> ul").append(k)}}else g.hasOwnProperty("value")&&(h.addClass("ms-reflow"),d._addOption(h,g));e.append(h)}e.find('.ms-reflow input[type="checkbox"]').each(function(b){if(a(this).css("display").match(/block$/)){var c=a(this).outerWidth();c=c?c:15,a(this).closest("label").css("padding-left",2*parseInt(a(this).closest("label").css("padding-left"))+c),a(this).closest(".ms-reflow").removeClass("ms-reflow")}}),d._updatePlaceholderText()},unload:function(){a(this.element).next(".ms-options-wrap").remove(),a(this.element).show(function(){a(this).css("display","").removeClass("jqmsLoaded")})},reload:function(){a(this.element).next(".ms-options-wrap").remove(),a(this.element).removeClass("jqmsLoaded"),this.load()},_updatePlaceholderText:function(){var b=this,c=a(b.element).next(".ms-options-wrap").find("> button:first-child"),d=a(b.element).next(".ms-options-wrap").find("> .ms-options"),e=d.parent().prev(),f=[];e.find("option:selected").each(function(){f.push(a(this).text())}),c.text(f.join(", "));var g=c.clone().css({display:"inline",width:"auto",visibility:"hidden"}).appendTo(d.parent()),h="undefined"!=typeof a.fn.actual?g.actual("width",b.options.jqActualOpts):g.width(),i="undefined"!=typeof a.fn.actual?c.actual("width",b.options.jqActualOpts):c.width();h>i?c.text(f.length+" selected"):f.length?c.text(f.join(", ")):c.text(b.options.placeholder),g.remove()},_addOption:function(b,d){b.text(d.name),b.prepend(a('<input type="checkbox" value="" title="" />').val(d.value).attr("title",d.name).attr("id","ms-opt-"+c)),d.checked&&(b.addClass("default"),b.addClass("selected"),b.find('input[type="checkbox"]').prop("checked",!0));var e=a("<label></label>").attr("for","ms-opt-"+c);b.wrapInner(e),this.options.showCheckbox||b.find('input[id="ms-opt-'+c+'"]').hide(),c+=1},_ieVersion:function(){var a=navigator.userAgent.toLowerCase();return a.indexOf("msie")!=-1&&parseInt(a.split("msie")[1])}},a.fn.multiselect=function(b){var e,c=arguments;return void 0===b||"object"==typeof b?this.each(function(){a.data(this,"plugin_multiselect")||a.data(this,"plugin_multiselect",new d(this,b))}):"string"==typeof b&&"_"!==b[0]&&"init"!==b?(this.each(function(){var f=a.data(this,"plugin_multiselect");f instanceof d&&"function"==typeof f[b]&&(e=f[b].apply(f,Array.prototype.slice.call(c,1))),"unload"===b&&a.data(this,"plugin_multiselect",null)}),e):void 0}}(jQuery);